#!/bin/bash

echo "üîß Correction de l'encodage dans le dossier: $1"
echo ""

fixed=0
total=0

# Parcourir tous les fichiers .dart
for file in $(find "$1" -name "*.dart"); do
    total=$((total + 1))
    
    # Faire les remplacements avec sed
    if sed -i '' \
        -e 's/√É¬∞√Ö¬∏√Ç¬§√¢‚Ç¨"/ü§ñ/g' \
        -e 's/√É¬∞√Ö¬∏√Ö¬Ω√Ç¬Ø/üéØ/g' \
        -e 's/√É¬∞√Ö¬∏√Ç¬ß√Ç /üß†/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨≈ì√Ö /üìä/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨≈ì√Ç¬¢/üì¢/g' \
        -e 's/√É¬∞√Ö¬∏√Ö¬Ω√Ç¬¥/üé¥/g' \
        -e 's/√É¬∞√Ö¬∏√Ç¬§√¢‚Ç¨/ü§î/g' \
        -e 's/√É¬∞√Ö¬∏√Ç√Ç/üèÅ/g' \
        -e 's/√É¬∞√Ö¬∏√Ö¬Ω√Ç¬≤/üé≤/g' \
        -e 's/√É¬∞√Ö¬∏√Ü'√Ç/üÉè/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨√¢‚Ç¨≈æ/üîÑ/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨Àú√Ç√É¬Ø√Ç¬∏√Ç/üëÅÔ∏è/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨√Ç/üîç/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨‚Ñ¢√Ç¬≠/üé≠/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨‚Ñ¢√Ç¬™/üé™/g' \
        -e 's/√É¬∞√Ö¬∏√Ö¬°√Ç¬®/üö®/g' \
        -e 's/√É¬∞√Ö¬∏√Ö¬° √É¬Ø√Ç¬∏√Ç/‚ö†Ô∏è/g' \
        -e 's/√É¬∞√Ö¬∏√Ö¬Ω√Ç¬¨/üé¨/g' \
        -e 's/√É¬∞√Ö¬∏√Ö¬Ω√Ç¬Æ/üéÆ/g' \
        -e 's/√É¬∞√Ö¬∏√Ç√¢‚Ç¨ /üèÜ/g' \
        -e 's/√É¬∞√Ö¬∏√Ç¬•√¢‚Ç¨¬∞/ü•â/g' \
        -e 's/√É¬∞√Ö¬∏√Ç√Ü'/üèÉ/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨√Ç¬µ/üòµ/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨≈ì√Ç¬≥/üì≥/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨"√¢‚Ç¨Àú√É¬Ø√Ç¬∏√Ç/üóëÔ∏è/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨‚Ñ¢√¢‚Ç¨/üé∞/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨√Ö¬°/üîö/g' \
        -e 's/√É¬∞√Ö¬∏√¢‚Ç¨¬π√Ç¬°√É¬Ø√Ç¬∏√Ç/üõ°Ô∏è/g' \
        -e 's/√É¬∞√Ö¬∏√Ç√¢‚Ç¨/üèÜ/g' \
        -e 's/√É¬∞√Ö¬∏√Ö'√¢‚Äö¬¨/üí∞/g' \
        -e 's/√É¬¢√Ç√Ö'/‚ùå/g' \
        -e 's/√É¬¢√Ö"√¢‚Ç¨¬¶/‚úì/g' \
        -e 's/√É¬¢√Ö¬°√Ç¬°/‚ö°/g' \
        -e 's/√É¬¢√Ç√Ç¬±√É¬Ø√Ç¬∏√Ç/‚è±Ô∏è/g' \
        -e 's/√É¬¢√Ç√Ç¬∞/‚è∞/g' \
        -e 's/√É¬¢√¢‚Ç¨"√Ç¬∂√É¬Ø√Ç¬∏√Ç/‚ñ∂Ô∏è/g' \
        -e 's/√É¬¢√Ç√Ç¬∏√É¬Ø√Ç¬∏√Ç/‚è∏Ô∏è/g' \
        -e 's/√É¬¢√¢‚Ç¨ √Ç/‚Üí/g' \
        -e 's/√É¬¢√¢‚Ç¨¬∞√Ç¬§/‚â§/g' \
        -e 's/√É¬¢√Ö¬°√¢‚Ç¨√É¬Ø√Ç¬∏√Ç/‚öîÔ∏è/g' \
        -e 's/√É¬¢√Ö¬°√¢‚Ç¨"√É¬Ø√Ç¬∏√Ç/‚öñÔ∏è/g' \
        -e 's/√É¬¢√Ö"√Ç¬®/‚ú®/g' \
        -e 's/√É∆í√Ç¬©/√©/g' \
        -e 's/√É∆í√Ç¬®/√®/g' \
        -e 's/√É∆í√Ç¬™/√™/g' \
        -e 's/√É∆í√Ç /√†/g' \
        -e 's/√É∆í√Ç¬ß/√ß/g' \
        -e 's/√É¬©/√©/g' \
        -e 's/√É¬®/√®/g' \
        -e 's/√É¬™/√™/g' \
        -e 's/√É /√†/g' \
        -e 's/√É¬ß/√ß/g' \
        "$file" 2>/dev/null; then
        echo "‚úì Corrig√©: $file"
        fixed=$((fixed + 1))
    fi
done

echo ""
echo "=================================================="
echo "Traitement termin√©:"
echo "  - Fichiers trait√©s: $total"
echo "  - Fichiers corrig√©s: $fixed"
echo "=================================================="